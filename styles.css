:root{
  --bg:#0e1b20; --surface:#0e1b20; --divider:#132e36;
  --text:#e9f1f1; --muted:#9fb1b8;
  --token:#0f2c35; --token-border:#1f3b44;
  --accent:#58cc02; --accent-2:#6ee300; --danger:#ff4b4b;
  --shadow:0 10px 30px rgba(0,0,0,.35); --radius:14px;
  --font:'Nunito',system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;

  /* lesson image sizes */
  --img-size-uncompleted: 100px;
  --img-size-completed:   100px;

  /* rightbar image macros */
  --league-size: 120px;   /* Emerald league badge size */
  --quest-size: 44px;     /* quest1/2/3 size */
  --chest-size: 50px;     /* chest.png size */
}

*{box-sizing:border-box}
html,body{height:100%}
html{font-size:16px}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:var(--font);
}

/* Generic variable-sized image helper */
.img-var{
  height:var(--img-size,24px);
  width:auto;
  display:block;
  object-fit:contain;
}

/* Convenience wrappers using root macros */
.u-size-league{ --img-size: var(--league-size); }
.u-size-quest{  --img-size: var(--quest-size); }
.u-size-chest{  --img-size: var(--chest-size); }

.app-shell{
  display:grid;
  grid-template-columns:300px 1fr 380px;
  gap:16px;
  min-height:100vh;
}
.sidebar,.rightbar,.main{background:var(--surface)}

/* LEFT SIDEBAR */
.sidebar{
  border-right:1px solid var(--divider);
  padding:16px 8px;
  position:sticky;
  top:0;
  height:100vh;
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:10px;
}
.brand{width:100%;display:flex;justify-content:center;padding:8px 0 14px}
.brand-mark{
  width:38px;height:38px;border-radius:10px;
  display:grid;place-items:center;
  background:#0c1f25;border:1px solid #1f3a43;font-size:22px;
}
.side-nav{width:100%;display:flex;flex-direction:column;gap:8px}

/* Sidebar buttons with custom image icons */
.tab{
  width:100%;
  display:flex;
  align-items:center;
  gap:10px;
  padding:10px 12px;
  border-radius:12px;
  background:transparent;
  color:var(--text);
  border:1px solid transparent;
  cursor:pointer;
  text-align:left;
  font-weight:800;
  transition:background 0.2s, transform 0.1s, border-color 0.1s;
}
.tab:hover{
  background:#0c1f25;
  border-color:#1f3b44;
  transform:translateX(2px);
}
.tab.active{
  background:#0c1f25;
  border-color:var(--accent);
}

.tab-icon{
  width:22px;
  height:22px;
  display:block;
  object-fit:contain;
  flex-shrink:0;
}
.tab-label{
  font-size:1.1rem;
  font-weight:800;
  color:#ffffff;
  white-space:nowrap;
  letter-spacing:0.3px;
}

/* MAIN CENTER AREA */
.main{padding:0 0 24px;position:relative}

/* Sticky colored banner */
.section-banner{
  position:sticky; top:0; z-index:5;
  max-width:50%;
  margin:0 auto 6px;
  transition:background-color 120ms linear;
}
.sb-left{display:flex;align-items:center;gap:10px}
.back-arrow{
  width:40px;height:40px;border-radius:12px;
  border:1px solid rgba(0,0,0,.25);
  background:rgba(0,0,0,.1);
  color:#08210e;font-weight:900;cursor:pointer;
}
.sb-sub{font-size:.8rem;font-weight:800;opacity:.95}
.sb-title{font-size:1.2rem;font-weight:900}

/* Roadmap (endless) */
.home{padding:12px 0 120px;position:relative}
.roadmap-column{
  max-width:900px;
  margin:0 auto;
  display:flex;
  flex-direction:column;
  gap:40px;
  position:relative;
}

/* Allow connectors to show under nodes */
.chapter-group{position:relative;}
.nodes{position:relative;}
.chapter-man{pointer-events:none;z-index:0}
.chapter-group[data-side="left"]  .chapter-man{left:-160px;}
.chapter-group[data-side="right"] .chapter-man{right:-160px;}

/* Lesson nodes */
.nodes{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:24px;
}
.node{
  display:grid;
  place-items:center;
  cursor:pointer;
  user-select:none;
  transform:translateX(var(--x,0px));
  transition:transform .15s ease;
  z-index:1;
}
.node:hover{
  transform:translateX(var(--x,0px)) translateY(-3px);
}
.node img{
  display:block;
  height:128px;
  width:auto;
  object-fit:contain;
  border:none;
  border-radius:0;
  background:transparent;
}

/* dynamic classes from JS */
.node img.img-uncompleted{ height:var(--img-size-uncompleted); width:auto; }
.node img.img-completed{   height:var(--img-size-completed);   width:auto; }

/* Lesson */
.lesson-stage{position:fixed;inset:0;background:var(--bg);z-index:40;display:none}
.lesson-stage:not(.hidden){display:block}
.top-strip{
  height:56px;display:flex;align-items:center;
  justify-content:flex-end;padding:0 24px;
}
.progress-ghost{
  flex:1;height:10px;border-radius:999px;
  background:#2a3e45;margin-right:12px;
}
.lives{font-weight:900;color:#e9f1f1}

.exercise-core{
  max-width:820px;margin:0 auto;
  padding:0 20px 140px;
  display:flex;flex-direction:column;align-items:flex-start;
}
.exercise-title{
  margin:16px 0 12px;
  font-size:1.6rem;font-weight:900;
  text-align:left;
}
.avatar-row.left{
  display:flex;align-items:center;
  gap:14px;margin:8px 0 16px;
}
#exerciseAvatar{
  height:112px;width:auto;
  border-radius:18px;
  border:1px solid #12323a;
  background:#092027;
  object-fit:contain;
}
.bubble{
  background:#0b2630;color:var(--text);
  border:1px dashed #2a4952;
  padding:8px 10px;border-radius:10px;
  font-size:1rem;
}

.choice-list{
  width:min(640px,92vw);
  display:flex;flex-direction:column;
  gap:12px;margin-top:6px;
}
.choice{
  display:grid;
  grid-template-columns:44px 1fr;
  align-items:center;
  gap:12px;
  padding:12px 16px;
  border-radius:14px;
  border:1px solid #1f3a43;
  background:#0f2630;
  cursor:pointer;
  font-weight:800;
  color:#fff;
}
.choice .num{
  width:36px;height:36px;border-radius:10px;
  display:grid;place-items:center;
  border:2px solid #2a5663;
  color:#9fd0df;
}
.choice.selected{outline:2px solid #2a5663}
.choice.correct{border-color:#1e6f36;background:#113522}
.choice.incorrect{border-color:#6f1e1e;background:#321717}

.match-grid{
  width:min(640px,92vw);
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:18px;margin-top:10px;
}
.column{
  display:flex;flex-direction:column;
  gap:10px;
}
.match-item{
  padding:12px 14px;border-radius:12px;
  background:#0f2630;border:1px solid #1f3a43;
  font-weight:800;cursor:pointer;
  color:#fff;text-align:center;
}
.match-item.selected{outline:2px solid #2a7a66}
.match-item.matched{opacity:.45;pointer-events:none;filter:saturate(.6)}

/* Footer buttons */
.lesson-footer{
  position:fixed;
  left:300px;right:380px;bottom:0;
  background:var(--bg);
  border-top:1px solid #13323a;
  display:flex;justify-content:center;
  gap:56px;padding:16px 0;
  z-index:41;
}
.btn{
  height:44px;border-radius:12px;
  font-weight:800;letter-spacing:.4px;
  cursor:pointer;border:1px solid transparent;
  padding:0 28px;
}
.btn-ghost{
  background:transparent;
  color:#9fb1b8;
  border-color:#1c3942;
}
.btn-ghost:hover{
  color:#e9f1f1;
  border-color:#2a5663;
}
.btn-primary{
  background:linear-gradient(90deg,var(--accent),var(--accent-2));
  color:#08210e;border:none;min-width:160px;
}
.btn-primary:disabled{
  background:#2a3e45;color:#7b8c93;cursor:default;
}
.btn-danger{background:#a12e2e;color:#fff}

/* Popover */
.popover{position:fixed;inset:0;pointer-events:none}
.popover.hidden{display:none}
.popover-card{
  position:absolute;min-width:260px;
  background:#2c9cdb;color:#08161a;
  border:1px solid rgba(0,0,0,.2);
  border-radius:14px;padding:14px;
  box-shadow:0 10px 30px rgba(0,0,0,.35);
  pointer-events:auto;
}
.popover-start{
  background:#fff;border:none;color:#2c9cdb;
  font-weight:900;height:44px;
  border-radius:12px;padding:0 18px;
}

/* RIGHT BAR */
.rightbar{
  border-left:1px solid var(--divider);
  padding:16px;
  position:sticky;top:0;
  height:100vh;overflow:auto;
  display:flex;flex-direction:column;
  gap:16px;
}
.rightbar.wide{width:380px}
.card{
  background:#0c1f25;
  border:1px solid #1f3a43;
  border-radius:16px;
  padding:14px;
  box-shadow:var(--shadow);
}
.card-title{font-weight:900;margin-bottom:10px}
.mini-list{margin:0;padding-left:18px;color:#9fb1b8} /* left for compatibility */
.small{height:36px;padding:0 12px}
.stats.one-row{
  display:grid;
  grid-auto-flow:column;
  grid-auto-columns:1fr;
  gap:8px;
}
.pill{
  background:#0c1f25;
  border:1px solid #1f3a43;
  padding:8px 10px;
  border-radius:999px;
  font-weight:800;
  text-align:center;
}

/* Stats row with icons */
.stats-row{
  display:flex;
  align-items:center;
  gap:10px;
  flex-wrap:wrap;
}
.stat{
  display:flex;
  align-items:center;
  gap:8px;
  background:#0c1f25;
  border:1px solid #1f3a43;
  border-radius:999px;
  padding:6px 10px;
  font-weight:800;
  white-space:nowrap;
}
.stat-icon{
  height:20px;width:auto;
  display:block;object-fit:contain;
}
.stat-text{color:#e9f1f1;}

/* Emerald card */
.league-card .card-title{
  display:flex;
  align-items:center;
  gap:10px;
}

/* Daily Quests slider */
.quest-strip{
  display:flex;
  align-items:center;
  gap:14px;
  overflow-x:auto;
  padding:6px 2px;
  scrollbar-width:thin;
}
.quest{
  display:flex;
  align-items:center;
  gap:10px;
  background:#0c1f25;
  border:1px solid #1f3a43;
  border-radius:12px;
  padding:8px 10px;
  white-space:nowrap;
}
.quest-label{
  color:#9fb1b8;
  font-weight:800;
}
.quest-bar{
  width:120px;height:10px;
  border-radius:999px;
  overflow:hidden;
  background:#0c2730;
  border:1px solid #183640;
}
.quest-bar > div{
  height:100%;
  background:#58cc02;
}

/* RESPONSIVE */
@media (max-width:1100px){
  .app-shell{grid-template-columns:72px 1fr 0}
  .rightbar{display:none}
  .tab-label{display:none}
  .sidebar{padding:12px 6px}
  .lesson-footer{left:72px;right:0}
}
@media (max-width:720px){
  html{font-size:15px}
}
